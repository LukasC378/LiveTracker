using System.Net.Http.Headers;
using System.Text;
using GeoJSON.Net.Feature;
using GeoJSON.Net.Geometry;
using Newtonsoft.Json;
using Npgsql;
using SessionAPICommonModels;
using SessionAPICommonModels.Dtos;


#region Program

var client = new HttpClient
{
    BaseAddress = new Uri("https://localhost:7111")
};

const string user = "SessionApiUser";
const string password = ";q%%%hP[cD#'z6F3d@k3s(5x-@Z";
const string connectionString = "Server=127.0.0.1;Port=5432;Database=race_tracker_db;User Id=postgres;Password=0000;Include Error Detail=true;";

const int delay = 200;
const int raceId = 2;

var random = new Random();

string token;
IDictionary<string, int> drivers = new Dictionary<string, int>();
IList<Position> points;

SimulateRace();
//StartStressTest();

#endregion

#region Functions

void SimulateRace()
{
    var raceDataDto = GetRaceData();
    points = GetTrackPoints(raceDataDto.GeoJsonData);

    LoadRaceData(raceDataDto);
    LoadDriversPositions(raceDataDto.Drivers);

    var driversId = raceDataDto.Drivers.Select(x => x.Id.ToString()).ToList();

    while (true)
    {
        foreach (var driverId in driversId)
        {
            SimulateMovement(driverId);
        }
        SendGpsDataToBackend();
        Thread.Sleep(delay);
    }
}


void StartStressTest()
{
    token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1laWRlbnRpZmllciI6IjciLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiVXNlciIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvdXNlcmRhdGEiOiIxIiwibmJmIjoxNjg0MjM1Mjg2LCJleHAiOjE3Nzg5NDc2ODYsImlzcyI6Iklzc3VlciIsImF1ZCI6IkF1ZGllbmNlIn0.4yE_RsT6fM7LeQeatFGgNQk9INl1sZMwaqIOxdwyzFk";

    //500 drivers
    var driversList = JsonConvert.DeserializeObject<IList<Guid>>(
        "[\"ad264ed4-db6d-4383-bd68-62799dd17749\",\"a923dc5a-1516-42e9-b578-9189ba9a4558\",\"62b4b2f2-f3e8-4e86-9b8a-c2384f1c7144\",\"33f76491-df6c-4d6c-a78f-93bd9982192a\",\"420c3951-a68f-4051-bd74-fc9159baa719\",\"603321c5-8039-4377-889f-4244db3048c2\",\"ec487828-5c71-48e7-acb9-e392b9a11f09\",\"97bff6d7-ea79-4908-a646-540151f188ad\",\"49e4ac1c-4abd-4c74-9c0e-a4db66f5e260\",\"e0ac971b-d67c-4f0b-823d-506d1fc83d9a\",\"07f10364-0def-4b52-928e-2835a886bd80\",\"3c838422-18c6-4988-b210-2680060a2feb\",\"f61d7db4-9486-40b0-ab79-d3a13b48f9ed\",\"9e0f87af-5101-4b89-bb96-2d912b21cbcf\",\"2af77586-457e-4595-bab1-461700cc2286\",\"5ad9ec5c-2d51-4d89-88ed-f7448b98a794\",\"41034d3e-3acd-40e4-af06-1d1b9953a221\",\"2c1d580f-4566-4ad8-99d8-a53b9bf183da\",\"38dca213-b352-4af0-94e6-0e1cf587522b\",\"45305fb3-c5bc-4b76-950d-33a279e1999d\",\"ea55a0a4-aef0-4941-a513-d2d5f5904a27\",\"7e286192-9b7b-4e18-8ead-a76e07927d14\",\"76fa5154-1b14-4be8-98ea-7ccadc850c1c\",\"e7c32201-c29e-4018-949c-c59379d4aeab\",\"4f43c199-aa25-4134-b320-589a63103ad5\",\"40b66987-1b87-483e-be32-d23c6e229fc3\",\"8d387693-90e2-4f33-9817-d5bddaf0297a\",\"674eebea-ba96-4475-b1df-64d385df5580\",\"b9ac673a-d78f-42ec-b966-c3f8760d4558\",\"7b2fb2d0-f00e-4602-86e9-21bbbc01871f\",\"8733b01a-3dde-45c9-a6cf-fb2002038e24\",\"e100eab2-a28d-4f13-a623-28c483368e84\",\"0c1a9c71-63e9-4e9e-89f1-594218798a86\",\"6412163e-55e8-4fca-abd7-389587749576\",\"b710ecd8-f155-4dd3-9b40-7ea0eaac6198\",\"072eb313-ea3f-4bf6-b159-932b6a06d9b6\",\"2d4dcb7a-6f5c-4f21-a3c5-ae52f4847888\",\"b85fed0b-b085-420e-8c9c-fdf0c91fd734\",\"8903f21f-2071-4355-bc83-06e9f851cc4a\",\"dca67e4f-42f6-4803-97a5-f834e2e05b3b\",\"11370e52-d6d5-47cc-9240-9e54a6af4df3\",\"da8b91f2-50e3-4442-a544-76f7c0e98365\",\"0f99c84f-64bd-4f48-acfd-32c508b2fd22\",\"93fd1b2c-3d2f-4816-8e45-87d603c7afa2\",\"8ed02562-b9b8-4406-9ed4-d90316ef5138\",\"5c2fd91b-14e3-41e2-b32f-417f19529270\",\"373ff71c-4074-409e-8ff3-12d2683d798b\",\"a2ff7b44-6349-4980-8d0a-6c9cf1606536\",\"99b08126-6031-425f-a05f-aeb8d2d51581\",\"7c8c8073-afc3-46fb-a4b8-004b7df6424a\",\"adad3b0f-9a14-41a7-8b19-34a13480c83f\",\"19bba4f9-b54a-473d-a168-ac6cecb51f16\",\"60fddae7-f71d-4eb6-a5ae-d8a323974787\",\"473e133e-734d-4a85-8830-8a9ed6b0abf2\",\"6d0ff4b1-2997-4335-a1e1-1eb9b9c13128\",\"b4ce7811-906b-438e-9b46-a261d30c8acb\",\"991399cb-89c2-4aa4-9dfb-9f1989f4d224\",\"a15b54d8-b570-400f-8ba1-0cea7306d88b\",\"0d0d17a6-31e2-4269-805c-ae5250d1d3b0\",\"e639c99b-93bd-4f7a-b646-1cc5cca7d2e4\",\"a40d894b-0140-408c-b2ce-5e316fb8798d\",\"b9682268-b8c8-4d1c-b6e9-d5760fef9b90\",\"4df8810f-c9fb-45de-9470-883338950943\",\"9b19b901-0db7-447d-a47a-003f36e82241\",\"2cae88c5-76ff-4a72-b005-ca290dea5f45\",\"3cf18402-2ff4-4743-903f-a6bdfe6dadad\",\"309e177a-d59e-41e3-a494-4b1d20fa887d\",\"0dc1a522-5083-43f4-a5a5-5cc6eb0a7fd1\",\"267fddbf-5582-4796-a96e-4d48f8625b49\",\"97ac52bd-99cb-4c7b-828e-63302c61fa5d\",\"98cfcca9-9531-42b1-83f1-7cac8207ea12\",\"ddbc2509-e44f-4139-9397-4548cf482d5b\",\"51523a64-3a71-479e-a788-f3f0a5ccff11\",\"080f2611-0f9a-447e-aefa-70e27f07dbc8\",\"a2d14c93-0fd8-4320-a9b6-a32ef3574390\",\"f37384f7-0384-4a06-9211-e23f85fd4b2d\",\"516f1aa4-ae16-4246-9d06-3a1066518ad5\",\"32744137-1919-46a4-a690-32e7648bd111\",\"bddbfa5f-e2d3-4421-90bd-81c4a567400b\",\"65ba9edd-5507-4ddd-8ddd-b1656f213a51\",\"2203c00b-35dd-4d57-a4f4-39119728ff5d\",\"a0fcbdc1-6407-4be5-8b9f-e472d432bebb\",\"5667c62e-6db1-4f46-9259-dfe65cb6b790\",\"71caefd9-746a-4740-9d8e-375aad1a48ff\",\"5bff6102-33d4-41f9-85fb-6e0d3acfe274\",\"9f02321f-be44-4009-9ad3-37a117caa6d7\",\"6127629c-b4fd-4365-be52-6512898e224e\",\"89d9053c-75a7-432d-b1f6-fbced2d1fbe9\",\"d7fbdbd0-5a11-44c1-986a-d78f5c0152d4\",\"8637757c-b77c-468b-a20b-429d153dbecf\",\"589d6e02-edbf-41c1-9bc8-d4c99aef46b2\",\"5a469b3e-1749-492e-b776-4cc44e2f8528\",\"94a34f73-be30-425a-97ff-f4b92b5e8a20\",\"40d7098f-bbf8-44b4-8770-2292643383cc\",\"664ca574-1480-489d-9079-f8fa45dd936f\",\"ac7c0e6d-1afa-40cc-9238-e6fb82f63d77\",\"01d89737-9dc1-4baa-88b2-7f47e0a2e379\",\"376f68de-9e0e-40d0-86ce-8b0eeab223ac\",\"8345c7a6-4163-4c84-88ff-1b02d46d0c17\",\"47358307-13a6-472b-994b-362f707ba047\",\"b869d470-5866-4d1a-ba4a-a9a63e1e8cc6\",\"81e8ad45-180f-4457-b4cd-23a378be4b1f\",\"c1a5354b-6398-48f8-9bcd-f6720043e87b\",\"c49da165-870b-46bf-a4e7-eeb41aea3b0b\",\"174c80fc-60bb-4fbe-bf86-e99e7f4faa20\",\"f865ff8b-d52b-4397-a14e-eed0d917fda5\",\"8aa43458-26e9-41c0-9bb7-0b7068186331\",\"52c897fa-4540-45e9-8987-721843af2131\",\"ec126ac8-297d-4cb8-84c7-f485fff62f23\",\"487bc400-b985-42ea-9992-94d099d54009\",\"640ac4eb-8274-4c17-b07b-1b6b3bad17d3\",\"88391fb1-4dc4-4843-a1af-91cdceda2890\",\"a45897aa-b1f1-425f-b574-002eb33d236d\",\"7ce12b9e-ca7b-4602-9202-e05a6ed76d10\",\"b5395366-6a22-40e8-a13e-9b3b7b361d19\",\"2d63ffff-923e-4e52-baa8-6df5c746e4fa\",\"c0bed797-fb01-4c7e-bf11-59d353014306\",\"57158d57-e154-4b3d-a646-688cf788ab36\",\"025cafa9-878e-43d0-9142-6a22edba557f\",\"1a80fd53-5d91-4dbc-958c-adaf458cea69\",\"4b7c20f1-0859-4db8-810b-2d016e3c2c97\",\"dd07c463-33ff-40e6-8f05-1888fb225f42\",\"d51bf60c-0d47-4336-92b5-bdf9d9af17a2\",\"5d96e2a6-9c69-4f59-a22c-e8ec4af0c496\",\"98643f72-ef7b-486b-8a36-d667f89c2767\",\"0c8bb231-3ba4-4055-a480-72111271aca7\",\"2cda5473-5fe7-43a7-a4c1-e90d1e28eed9\",\"5963576a-1da3-4094-bdad-b828f9421609\",\"6935f98b-3ce9-4d67-aa9c-78be1869409f\",\"5846bf53-8c79-4dc8-b9cf-531ec6ad458b\",\"5a29ffea-3f21-4397-bcae-54156da90dab\",\"644712bd-7813-4227-88f0-755de250aec7\",\"2b4a7162-e1e8-43be-a0ea-4908fa8ac106\",\"042a01f7-a9bc-473f-9025-9dfd7e5da0a6\",\"78258ae3-d721-4108-aa86-bb2c631391a7\",\"78c01424-7367-4d0d-910d-c83b44558093\",\"77da76ab-c43b-447b-ba33-3577e4365b9c\",\"0eb2e1be-36e9-4eba-b83c-124274ebca9f\",\"b2b2e24a-9fa0-4e5e-a84f-a53145a6312f\",\"283e7f27-104c-4ab3-a0be-7d69a5ed8f46\",\"f9131a40-9a81-4d55-97da-f630010bf43f\",\"d7b271fe-5bb9-4c2f-ab8b-bf65624aabc5\",\"46546942-cea7-4dad-b7ea-2e5d300c39cb\",\"51d775e4-ddde-44b5-9f12-c957845b94ec\",\"6949c9be-619d-40ea-ada6-17b448f067f3\",\"2ae3fb54-e695-43bd-a033-31c4eb3d0158\",\"85e61160-7a8b-4f64-8e82-8e353cd3f0c2\",\"dc5af764-d1f0-4850-b553-ff8b370ce52b\",\"b3f1857e-0d16-4abf-ac7f-6ff62840051f\",\"f026ff17-e3d2-48cc-bda1-a4e5f973c28d\",\"caba0ca4-7984-4fe4-b8b0-afc86609ebc3\",\"0262b468-c6e0-4af8-9350-4396a905b0d3\",\"b7252750-25af-447c-8292-0961e5ea53a8\",\"b4490020-9ce0-41a0-9ba7-103b8319f535\",\"a73f14d2-a65b-4ca3-9d33-4015a2012c78\",\"d9f49c67-a68a-4f4e-a266-bd88ba67638f\",\"d676cfc1-abe8-4af4-8cbf-1c152630ad83\",\"52b51224-747b-4dd0-a9c5-b78dfb99efda\",\"0a638f24-9da8-43af-bc66-8554f7a0946f\",\"47cc9623-d83f-4cbc-8dda-06047bb21c2b\",\"28ed332c-a002-4627-b8b8-1d27a3d1a061\",\"492e46fd-5ea7-455c-aa6a-181ced41eaea\",\"4f5f4e0a-5387-46aa-8e7c-5de1e7126dd3\",\"de9ccbaa-d830-46f6-b475-e24c1f32ef7a\",\"0a23db4e-0ee6-450a-92ec-41faf6c37a49\",\"54c47c6a-7dce-4319-8970-f37c009066f0\",\"aafde749-8710-475d-86fd-63d3a2d7c429\",\"0e3f9aad-3e18-482f-942d-e614f17e1e05\",\"e92029c3-5f07-40d5-bba3-30e270550b99\",\"d7eadebb-730f-464b-9481-4f1b36a540ca\",\"8b49676d-1abb-45e2-ad19-3115854783d5\",\"6f49d4e8-cc89-4612-8a05-7eb7192c7e91\",\"c489d9c8-089b-4834-814b-ab473d5b6676\",\"bf999920-e210-47ca-b9e4-a552dabe3b27\",\"0b35aeb9-9af2-446e-9acb-9aac93af6472\",\"5d6dbd3b-7c47-42aa-ae3a-edf6bfafd667\",\"3fb7e6ce-2914-488b-9445-82ac87e28bec\",\"75e3017b-3b72-48a9-b19d-b47b8464db16\",\"c7e33d49-a62f-48d6-a8e7-6b60a2623997\",\"b13f56f0-3f81-44a9-a00c-bb2e6dfe83ce\",\"f0b7e194-0d5d-466b-9da2-c0544571c699\",\"647feac3-4db5-43fc-a844-76a07a0fe5e0\",\"c84807fc-b94d-47b3-8be6-96e715b05aad\",\"63564792-bb77-47b6-a786-897f005fe586\",\"eb18c4cb-4df7-41c2-98ab-c7db7bd0318a\",\"26ebea51-63b3-44f9-b29f-ca317b9f187f\",\"826a62c8-3062-48c1-878c-1d49e5b3d79c\",\"7af9c19c-11d7-41c0-8bfd-017af3c8e240\",\"adc487ae-99be-4061-9094-9a56c688e3d7\",\"01174783-20e9-4a45-943a-e90638988aba\",\"bee3693a-eb57-49ec-bb50-88136cd8d7be\",\"b874247a-4599-43cd-84c8-ba725cc42046\",\"abe8f23e-d856-4bdb-b583-aba6981b47ce\",\"df1b944d-daae-4af5-9418-b619bb972714\",\"dbe933ef-8b5b-4166-a6d7-7cb7f03b2d74\",\"26afa21f-5716-4c1f-9aa3-301091c512ee\",\"e511a88d-5a74-4f64-9f23-f531d0cb4607\",\"f8d93e8f-98c8-432d-be10-f21ba1c0a836\",\"9a46be7a-f4be-44cb-92c2-c466d383b3dd\",\"526cfc59-20f2-4a73-8b19-43dc62d8c768\",\"432f7874-dedd-46bf-9efb-2c5450f8a747\",\"ef9ff1df-d818-46ae-b44d-35f1fba0e003\",\"17b85b82-0118-4493-8256-abb718b681ed\",\"83dad835-192a-4d23-aa80-403a9f4ad984\",\"df932651-e99b-4608-8723-ab7e19ec34b9\",\"94591ec4-0256-4a51-9287-ec2792a996b1\",\"5ec8530d-6d54-4a91-b1b8-1988c10a2706\",\"2a5ebc67-20b5-4c43-827f-5594a13be5d0\",\"639ddc1c-2f8c-4f85-9b9d-aca5f7f8bac9\",\"099b6109-cd37-43ff-b3cf-d64ab2775afd\",\"4d491c13-c4a4-4ab8-b368-a0a74bf90322\",\"1631a65d-2bc7-4daa-aa69-3047e9e1b656\",\"599ecdf8-4e1c-44ea-8d94-703b26efbd06\",\"6891c0db-d384-4d96-8129-ba7cbb58aa3e\",\"37eb16b8-1341-4fca-aa0d-7a02cc57adf0\",\"ae9a3c0f-296c-422f-afdf-f9780fa703dd\",\"d94daa94-897a-4f0e-b5e9-0fada7698691\",\"0df7e640-1212-4068-b4cb-7050355b553e\",\"ab4b77bb-4a41-4930-b94a-3350bdc44fbf\",\"bac72063-4f98-4882-aad2-6c4b2b73961d\",\"21791c00-3dfe-4a79-84cd-88f57e8dbdb4\",\"ac6c44a4-43f8-40ce-83e3-94101e007e91\",\"dd0c87c3-3cda-4011-8882-8bc75adc85d3\",\"f297c876-604a-4503-a7f5-53b672c2b0bd\",\"acd89382-b5ee-4d50-8595-0f65cec2b34c\",\"f46bc846-c12a-4549-bb1b-12554eda1e56\",\"157f8474-f355-4ff8-b320-7007ff9c7724\",\"9cf2f547-893a-426f-a016-20a427410b51\",\"b67d3fc5-d4db-4885-b05b-03487fe3a0f4\",\"c92b7095-5d3b-440b-8106-0d1cba093241\",\"023b9796-e7b9-4bf1-a769-71d5f65820bb\",\"741e37a8-a33a-452d-8585-d593fcde797a\",\"2fd8b693-f9f7-439e-9292-ad8f33cbd6b7\",\"a3b8a294-ad93-4d03-9bb8-c9cfb5ddbf69\",\"2c3e17d5-6372-4345-867d-d133db59422a\",\"828ed5ff-877b-46d8-8fad-f0c0b700f7aa\",\"671e84b0-339a-43b6-8741-a232a7fc255d\",\"da0edf7d-ac94-4ab8-a921-3839754de8fe\",\"7a0bf333-a478-4f59-9fdb-56945891d47a\",\"ec8e3799-d15c-4385-a4d2-0db100786e97\",\"63e664e5-f0c8-488c-98ad-d024ed5a4ce1\",\"3094288c-a200-4643-8183-55306f5950d6\",\"f249815e-d6de-4c80-ba22-65401fca3040\",\"acdcd52f-8840-482f-b8e9-2ede02db0d56\",\"8c78773e-8c8e-4a4d-812f-2181291e73e5\",\"fa860a92-dc91-4f43-bd87-ad9ea09c2305\",\"b6a66eb6-1d3c-4133-b779-f320486a1343\",\"c4d4891d-2c41-460f-ae9b-1110eecc7683\",\"7b203616-3fdf-48f5-9581-704d76e8bd60\",\"4f9a0f32-20d4-4b04-87fe-6867ce6245ad\",\"090712a6-6b70-4bee-bf74-ff992aa412be\",\"5b312a9d-9b01-432e-95cc-0138d167353c\",\"b47a0a13-364b-49fd-b4be-12dd6c95329c\",\"948cf1c3-a625-4ccb-81c6-7f7ed492b338\",\"aa04647d-52a4-48f7-9fd5-b41d19938dda\",\"3c62c308-7735-45cc-8ea6-70467a8c108a\",\"788dc5fd-93df-4e83-a3ea-0ea33586450c\",\"aa6dee53-170f-4983-b7fb-27216361dc27\",\"61c159d4-0a03-4849-913e-57d2053e83f5\",\"27ca3528-b5c7-44f5-8179-99b487fd98f8\",\"fd727afd-b010-4f9d-913c-176e94a80a67\",\"f32f8ce0-4e92-47f9-b564-8ba7d1e5f7ae\",\"5fb163cd-9181-4952-b720-249a0f870675\",\"2ad334b6-a615-460d-a40a-fe7c2bc6c9f7\",\"50ab0894-f80f-4197-b7f1-859f673e3893\",\"be8647b0-8715-422d-875c-9884d6090428\",\"1a7f8ad3-1f10-4fbf-a144-fa1460e2a090\",\"80dc1774-34ba-46eb-9484-2614adf4cf1e\",\"58d33a1f-c54a-4844-a29d-fd9b0edec135\",\"e201be16-be6b-414b-9d51-739e3c777737\",\"ec4617de-caa5-41d4-9054-6926d33a5851\",\"727a9395-600f-49ff-be99-1ed4ff22bf73\",\"c5148c7e-9e05-4d8f-b69d-46a59b9bddfc\",\"3b0eb4e4-3c6c-447f-9dd7-614a22c65a17\",\"ca6a8076-02d6-41a9-bd5b-22c22d6d790f\",\"37f3e4b0-f1e1-411e-b2e0-7ea744f90560\",\"9a2dcff9-719b-43ff-ad31-7f539d7ef1f4\",\"eac6fc32-4555-4ba3-abcb-ae3d649c504c\",\"ad790718-4f51-45f8-87c1-9c82db2dbece\",\"53c55033-2829-4fcd-9d7c-c403da9df640\",\"bc67b0e9-ff68-4f6f-829b-7424ab46f9da\",\"f77777aa-8c3b-41f7-a9e9-6834cd7bfacf\",\"40a5add4-a897-4818-bc59-06f869f16326\",\"5d8c2253-727f-45d7-a61a-d3c8a24da514\",\"d8213802-383d-4d27-aa36-f4753c99be38\",\"a8949c4e-20a6-415e-9d49-a9536d7ce71b\",\"704bac64-3ed7-47cc-a6f5-caade57872b0\",\"49214fca-102f-42c2-94db-6383f7695bbc\",\"d5cd1239-d461-44c1-96c3-d4160742ed70\",\"9e6a6a4f-bde8-407d-84f6-888f510ab6fb\",\"25a17944-e7d0-4698-a834-7077e2fca760\",\"88b51385-4abd-4716-9239-5fae7e040a58\",\"f54bfaeb-7d91-4d62-a075-c59190ca5004\",\"b042c871-1b9c-4599-8642-399dd6db3046\",\"25bce3ff-f2ac-43cc-8992-47a4b49c3f8a\",\"eb240c08-7aed-412d-8685-0b30e9143418\",\"b2dcbc8a-b7ef-4c26-be02-eab5c87342df\",\"37b8187f-6b6a-4fe8-a05a-5a714bf0c51d\",\"219174fb-e4ed-4012-81a9-8e65d091e1e8\",\"953e6745-ec16-407f-80b8-9bc249efbded\",\"6f751cfe-c229-4f84-a771-f616b92f134f\",\"f8216204-7a66-49ee-be67-b25ddae0910d\",\"8171d343-d4a0-4de2-8070-b3318bd176c2\",\"791a84af-7dd4-4c98-bb33-e76e7234b530\",\"478ace4a-4376-4344-a49f-672d512b7aad\",\"026163b5-43c9-427d-b60a-b9dcbb99c798\",\"67ffa5a6-3c94-4ece-a734-fd4dfe01c6a8\",\"31df955b-4fd8-42c8-8e83-290001897386\",\"e984f7a0-699f-48eb-88ab-3386b390d9f2\",\"4c634678-bbd9-4d9a-8bf1-67a93e62acb9\",\"5e9e2d51-5e8a-41d1-ad14-14935ff034d4\",\"36c975f8-b795-4575-b898-f664bcb4e24e\",\"b13dbd23-49fd-44ea-91cc-47d09a2cbbff\",\"5bd1ae92-6c59-4239-b377-c7e342531aa5\",\"b075e656-ac0e-4b85-88a8-72200bc687f8\",\"cfba0da7-e2b3-4106-8eba-a09c855032c4\",\"3720b7c0-69d7-4fa2-8586-308a1aeeafb0\",\"f65e4d95-6dc4-4389-b115-d2962616e38b\",\"8fc18aab-2b40-4336-a891-21cb51e0ae0c\",\"293240d9-8d93-44dc-ad68-20d178bb99f2\",\"7a645825-6924-4ef8-9529-987a248734fa\",\"937aa8a4-f7c5-4bdc-b5cb-c2f03250d75a\",\"d1eabeac-fd55-4ab7-bf74-96f70d7071a3\",\"f6651c18-18fa-4563-8bf5-00136f6d6eab\",\"3a3972cc-126c-46e3-af73-4c8c7e9b27fd\",\"c6ea1df0-505f-425d-a870-e8c59136fa98\",\"7f3a7e9b-f623-45e7-9368-f9e7a8ec94e1\",\"de78e5b6-be7e-48fd-942c-4495f0011669\",\"a18c91b0-2b2d-48f3-a28e-c1f81536fb21\",\"0940aa5a-293d-4a9e-91fd-beb850f2d376\",\"ec056f20-f831-4aea-81c2-f3091a17eb49\",\"1ae46dbd-cf4e-463e-8ab4-4ae395076824\",\"fd7850b9-204c-44ec-aa11-308a5ebcc40f\",\"b5a6b65e-cdeb-411b-98fa-369ecf12434d\",\"96d054d2-6bf8-4048-b1bf-607a5ec8fc08\",\"b0dde2b5-f5cd-4939-878d-d9aa007f98c2\",\"c1576803-d5bd-4f71-8e95-d0edc0e6c4f3\",\"2d3362d9-5baf-477b-ad38-602d026ecfd4\",\"396c897b-e005-4146-8ffa-df4af7835581\",\"9067a959-dc0c-49a7-8a72-093f6d4bf8aa\",\"92a5e9cc-797b-499b-ad95-f6212e27cad3\",\"6569cddf-e265-486a-aeda-dc50b99381aa\",\"b147b652-ec8b-4a1b-80d9-1da1d1d6f305\",\"b6ed74a8-b577-4e81-911d-3f6db04b908b\",\"a9fcb7f4-96f7-49cf-b28f-d8935176225c\",\"0cfdab5d-e110-4236-9c76-1cdf5dd78bc0\",\"d3d0061c-4d34-48d8-8bf4-07ed0218cb60\",\"b7cb1fc9-3e3f-4188-aee0-132ecb63c17a\",\"0bd0d9e1-b751-4933-8d2e-e9af97cd1626\",\"f5cee56d-a692-4c3b-9ecd-1c23c7fd655e\",\"78b7b886-6994-47bf-8eee-f11e313e0fc8\",\"a92855c3-c98f-4ef7-afcd-ab2d2dc97500\",\"046797c8-52b0-4612-9bf4-3eb9410fc976\",\"cd2dfe13-a181-402b-a638-424b35a8b832\",\"e7ca9540-8cb3-4f71-9c50-7e4377a8e027\",\"df728be4-fa4f-4263-9927-ccad0424240d\",\"5aa04699-53bc-4c51-b826-c5fd993bcc65\",\"bd124c54-c289-4923-84b4-1813230eb6cd\",\"d2f5d597-7fc5-4219-8ffe-352984b8fd79\",\"f6db75cf-d6c4-41c9-913f-5fbdc05040a0\",\"ea914b19-90fa-4034-a176-6edeb2d5afa6\",\"8eb82777-b43a-4342-a038-55e8b0a702d2\",\"6658295f-14ba-421f-aae3-0e1414ec5f5f\",\"7e17b6bd-7c5f-40be-a93f-0f410f5650c6\",\"2c6c5bb9-8722-44f7-8501-9ca756a8af03\",\"96300037-45fa-4e4e-8089-12fa9e662fd4\",\"a34fdd68-8c74-4837-aa3c-68305bce1673\",\"461ce546-9e2a-4eea-9076-22194ab5ff1d\",\"b81b24bf-d47b-4df6-a85d-7b01463622fc\",\"15199e20-5cd9-4e6b-821d-d91324db0a9d\",\"942a7125-626e-4d2e-9a38-100efd259bc9\",\"42e7977b-452f-4e06-9761-9b27ddeeaf62\",\"82e12e5b-0b26-4814-a920-06bab698f919\",\"d19e9c72-c695-4dba-8732-e3610e741236\",\"5ecaa038-6e08-4384-a874-4db53987f8ce\",\"b5a3799d-499c-415d-9138-ceb10acdf9f8\",\"6ff69d12-d976-4ffe-a563-ae2d82ab5575\",\"c673e72f-d5c3-4085-bcdd-18fa3bdc9e57\",\"ed652d4e-52a8-43fc-8266-3c55ef2124cc\",\"0df5e38c-140e-47fb-8a45-663e2c0506e7\",\"19fc2389-51e8-4d48-9639-bcde274a4493\",\"33725d8a-6b1f-47e0-bad7-4733a66cfc5c\",\"c28945f7-36b6-4c85-80d2-53777fa91fe1\",\"cda5ddbf-133d-47e0-9519-cb388b30090b\",\"37d23b33-db09-4a14-bcaf-51e3312206be\",\"ced09389-df9b-4573-a872-5f47b1f1492d\",\"b346520c-175f-49f7-9706-b8dc45e7c1c2\",\"a6b02ec5-dd90-4c3d-9400-e3e1a3b97380\",\"cc3a89cf-6a8c-4c05-8a73-d195dbd99f2b\",\"ffa16f38-fa80-4b7f-8e77-5ab77a959901\",\"294a1f53-6a03-42ed-abd3-a5a81fb58404\",\"4e70cde9-c922-4615-acc9-528715d69430\",\"6ffc7f54-b2be-455a-be9d-8b1246da89f3\",\"7c1de588-ec2e-47a8-9cab-14a0f96ed9e2\",\"d7af5ca7-41ef-47bf-a989-167efa17b3c7\",\"d4df7566-50c2-4f90-b904-1130cdda0db7\",\"f3bd4ea1-ad40-49b4-8922-535d151b3f89\",\"5019bb0c-2ee1-42d6-9260-257d66306837\",\"96dd7e35-c809-4cd3-8ef1-f65776633b07\",\"5429b0ea-f67e-4d90-919b-0ac3aaf80c10\",\"cadb504f-08fc-4c49-a09a-2ca5737df817\",\"e5c64e86-41b2-4bb6-855c-8cf38ee44580\",\"91ba7f83-10ff-4d1f-935f-990a78bbca69\",\"c4d4f621-40a0-4998-93d2-f70b757209ef\",\"7a8bcb26-5c0c-414b-b9b1-91664cd051cb\",\"f5c7e487-f362-4b48-95bc-19df9fa5c875\",\"6cb58a55-97a0-4d24-9e29-fd04097fd202\",\"327a5d57-55a2-4f5b-9e8d-764d12c7342c\",\"805f87dd-34a9-45b4-b170-6ba4c87c0a20\",\"bc16cf8c-5814-45b5-a26f-cceb7b9afa99\",\"7e045fcb-222d-4b94-995a-7ed2bd98d92b\",\"2f28a5c7-0488-4de6-85f5-83fb76778207\",\"5c9ff2f2-51b6-4926-8f21-3cd70f1a33e9\",\"41f3f157-2c47-4a17-80d3-2bb1610d9172\",\"5568f978-650e-4aee-ac0b-2d984c39205a\",\"f926ab9b-d724-4deb-94b2-434dbb11370d\",\"5197e890-0104-4542-9b7d-f051eeb31019\",\"4463a500-77a5-4184-a518-c50b95660f08\",\"6282f5f9-9af9-4c0b-ac0a-8039a185e1a7\",\"80a3704b-ed89-4341-97b8-809aa7184c4b\",\"0f2b2351-9787-4312-a556-2e48cc2f0384\",\"5f61f7ad-606b-46c3-ab91-b21aed1aba2a\",\"ee381bf0-9b44-4d55-bb57-fa88128399ce\",\"3c828b87-8830-47b5-bb5c-1470b36d347e\",\"717ffb21-8229-4d25-bd24-28ef6378c741\",\"43016adf-844e-4487-b7ea-5ad140ac8089\",\"57e4dd2c-4cfe-4efe-83ea-c154ed0a64bb\",\"b56d783a-0e7c-494a-95b3-59a506e4fd4e\",\"be199523-828e-4013-9a5e-63307b97c251\",\"e59939ee-29bb-4f22-9e17-40d42cf290ae\",\"d3a3aed7-52fd-4405-8ed8-a79c5e61328b\",\"ab0d1e9d-7832-4654-abf7-d4314d88515d\",\"d362b0a2-4bee-42b1-8dab-5e8f15481d43\",\"0ae8f056-3973-4610-bd4b-f28bd905fd16\",\"9e0c7986-7975-4fd6-b516-376cfbc4d1ff\",\"84f5a860-c100-4166-ade4-71bf385d7c1b\",\"0a13bbea-485c-477d-9342-7ca583986919\",\"8b4c0851-2077-4c05-b5fd-af211868855e\",\"463a6e1f-f07c-4176-beeb-7e2fbe1e2111\",\"62f583ba-7d4c-433a-a157-b7012a09fabf\",\"546632d0-def4-409c-8be0-254b81744768\",\"698af0dc-0808-43e8-86f1-73786f9e3ad6\",\"e183ecb7-b00d-4243-b8dd-3f96c35464ee\",\"c55a6f9e-23b6-4507-91f5-e4974e1be4b8\",\"7768ac55-3b59-432d-988e-cfde0341a88c\",\"348940f9-24e6-47bd-8fb0-8527ae284f4e\",\"11710e31-df4d-479f-a92b-30cc93c35964\",\"7979f85c-4093-408c-b323-a50adf42f607\",\"7ff5abe1-616d-49ed-9acd-619a5d9a6bd6\",\"d0df9b3c-6194-4e23-a1a6-4e63a5dc9445\",\"58e4b868-8ef2-4d87-b04f-4cca1e9efc64\",\"b9f2b968-ff74-46ef-833a-c9c1b86b3395\",\"27bbed63-8fe2-42d0-b72c-e781e9942bc8\",\"29356913-f9a3-41cc-95d7-7b38826434a6\",\"72b0b70b-63d0-4c68-98c2-9fc6f820c2b5\",\"3c366dc6-f138-4c5e-8dff-84b49b6092d0\",\"4a1b82ad-781a-4011-8c70-3c7c67eb7641\",\"06ab5704-869b-4301-a4f9-a62d1489c99f\",\"76a7b833-70c6-4c37-938c-3bdea97e8a24\",\"f3640255-1405-43d9-bb04-15c8fd5b365b\",\"e72286c1-9c68-4541-9cc2-2653bd50d057\",\"cbd1c72a-2126-4f14-8ba4-8c1737eb3488\",\"cbe1c1b9-f0dc-423f-924e-330689470905\",\"aecafa7e-ddd5-4aab-a919-f13852e256f0\",\"7d72317b-d2e0-4a54-8dac-cc7aff47051f\",\"484642ff-b170-486d-ac2a-ba63cf35f0ab\",\"6935df23-7868-4adf-86d1-c496191618ad\",\"88a70451-b3d8-4bb7-90a1-7b9cbfdc1fc8\",\"49ad6368-77d8-4d9e-ae96-c1f477f495a0\",\"8d0ccae4-dc80-422e-bd27-657bcf223c95\",\"827711f3-61bd-4b8e-995e-81ea47748ec0\",\"05b4837a-edeb-47dc-ac7d-77b97c94853f\",\"c1a09aa6-2c62-4acb-87bf-5534f579384e\",\"244698eb-66ce-46d4-8eb6-45b290be9ec1\",\"e3e4d1af-0519-45f7-aa2f-703a379c2312\",\"21c8d514-b9c6-4014-9f5e-4997acb99186\",\"57dcd892-0565-404e-808b-0dde638bb622\",\"cb70da69-db3c-4ad3-b226-df76fcec4ab4\",\"c8b6f195-133f-4316-a73d-5b7e66854b72\",\"96d0f448-8b2f-4024-905e-61229918f322\",\"d549b0e2-69e5-4343-90d9-c1433ea23a41\",\"2a806f87-c903-42cd-9161-b51aa023cc7d\",\"71d4a9dd-b40f-42ee-8e6c-bd5afae94f4e\",\"dd6fbfb6-d9f0-4bb4-a95c-8abd668768fd\",\"f4f371bc-55f3-4c87-9823-abaab73d2406\",\"cbe72e48-d7b4-46d3-951d-10d8262db488\",\"db750060-5468-4311-9f19-ae274cec4d6d\",\"2c179a97-189e-4a07-aae8-c595d038aeb5\",\"2e7d3dfe-8695-44ca-bf53-7c86486d7dc8\",\"cf9df55b-5697-490f-a9f1-edbe4d321e14\",\"0db69436-f85e-40dc-a374-dcd1574bf233\",\"d638fcb6-e167-4f32-80ef-65c9cdf57f70\",\"76e359be-f787-4b2c-b1b1-c0a2f03a688a\",\"8031a554-3939-4d9f-a607-6ca3ee853811\",\"92ae68f7-d693-4a3e-8879-c30df01320d2\",\"2ecb9968-a924-4e9d-8a91-06d16bd1f02e\",\"0d327a57-3e77-4036-8ea3-b75510f96695\",\"b3ca438d-924f-4863-9a70-3d10f6ed495c\",\"a0f75602-0a7d-48b9-bfb1-8cb30250a32f\",\"0b47b964-d165-4cf4-ba58-eacd5fc2b191\"]");

    //spa
    //const string geoJson = "{\r\n\"type\": \"FeatureCollection\",\r\n\"name\": \"be-1925\",\r\n\"bbox\": [ 5.959602, 50.427678, 5.977560, 50.446217 ], \r\n\"features\": [\r\n{ \"type\": \"Feature\", \"properties\": { \"id\": \"be-1925\", \"Location\": \"Spa Francorchamps\", \"Name\": \"Circuit de Spa-Francorchamps\", \"opened\": 1925, \"firstgp\": 1950, \"length\": 7004, \"altitude\": 413 }, \"bbox\": [ 5.959602, 50.427678, 5.97756, 50.446217 ], \"geometry\": { \"type\": \"LineString\", \"coordinates\": [ [ 5.96502, 50.444251 ], [ 5.963419, 50.446033 ], [ 5.963402, 50.446113 ], [ 5.963473, 50.446184 ], [ 5.963621, 50.446217 ], [ 5.963786, 50.446188 ], [ 5.964313, 50.446019 ], [ 5.965592, 50.445628 ], [ 5.966207, 50.445387 ], [ 5.966847, 50.445085 ], [ 5.967421, 50.444779 ], [ 5.967876, 50.444463 ], [ 5.970321, 50.442606 ], [ 5.970493, 50.442502 ], [ 5.970788, 50.442385 ], [ 5.971315, 50.442168 ], [ 5.971546, 50.442022 ], [ 5.971741, 50.441824 ], [ 5.971866, 50.441644 ], [ 5.971949, 50.441442 ], [ 5.97202, 50.441069 ], [ 5.972061, 50.440937 ], [ 5.972132, 50.440815 ], [ 5.972268, 50.440655 ], [ 5.973476, 50.439424 ], [ 5.974245, 50.438642 ], [ 5.974458, 50.43835 ], [ 5.974594, 50.438133 ], [ 5.974754, 50.437784 ], [ 5.975719, 50.435639 ], [ 5.977199, 50.432382 ], [ 5.977542, 50.431599 ], [ 5.97756, 50.431472 ], [ 5.977524, 50.431331 ], [ 5.977406, 50.431218 ], [ 5.977234, 50.431123 ], [ 5.977015, 50.431048 ], [ 5.976885, 50.430968 ], [ 5.976796, 50.430874 ], [ 5.976725, 50.430732 ], [ 5.976737, 50.430591 ], [ 5.977033, 50.429747 ], [ 5.977027, 50.429601 ], [ 5.97698, 50.429469 ], [ 5.97682, 50.429323 ], [ 5.97663, 50.429224 ], [ 5.973257, 50.427739 ], [ 5.973044, 50.427682 ], [ 5.972831, 50.427678 ], [ 5.972606, 50.42772 ], [ 5.972422, 50.427805 ], [ 5.972292, 50.427927 ], [ 5.972239, 50.42805 ], [ 5.972227, 50.428182 ], [ 5.972292, 50.428305 ], [ 5.97241, 50.428432 ], [ 5.972582, 50.428521 ], [ 5.974056, 50.429101 ], [ 5.974216, 50.429205 ], [ 5.974304, 50.429309 ], [ 5.97434, 50.429431 ], [ 5.974322, 50.429582 ], [ 5.973712, 50.430723 ], [ 5.973523, 50.431189 ], [ 5.973091, 50.432627 ], [ 5.972878, 50.433452 ], [ 5.972831, 50.433593 ], [ 5.972724, 50.433744 ], [ 5.972582, 50.433867 ], [ 5.972369, 50.433999 ], [ 5.972132, 50.434098 ], [ 5.971872, 50.434164 ], [ 5.971599, 50.434192 ], [ 5.970717, 50.43423 ], [ 5.97038, 50.434206 ], [ 5.970072, 50.43415 ], [ 5.969759, 50.434065 ], [ 5.969504, 50.433956 ], [ 5.969208, 50.433782 ], [ 5.969019, 50.433608 ], [ 5.968812, 50.433358 ], [ 5.967977, 50.432028 ], [ 5.967231, 50.430845 ], [ 5.967071, 50.430661 ], [ 5.966882, 50.430534 ], [ 5.966622, 50.43044 ], [ 5.966361, 50.430393 ], [ 5.966119, 50.430388 ], [ 5.965876, 50.430421 ], [ 5.965669, 50.430482 ], [ 5.965325, 50.430624 ], [ 5.9651, 50.430685 ], [ 5.964828, 50.430713 ], [ 5.964556, 50.430694 ], [ 5.964307, 50.430643 ], [ 5.964094, 50.430548 ], [ 5.963958, 50.43044 ], [ 5.963792, 50.430294 ], [ 5.962425, 50.428927 ], [ 5.962289, 50.428847 ], [ 5.962123, 50.42879 ], [ 5.961922, 50.428762 ], [ 5.961697, 50.428771 ], [ 5.961502, 50.428828 ], [ 5.960578, 50.429257 ], [ 5.960034, 50.429511 ], [ 5.959898, 50.429624 ], [ 5.959756, 50.429761 ], [ 5.959673, 50.429893 ], [ 5.959614, 50.430049 ], [ 5.959602, 50.430209 ], [ 5.959643, 50.430402 ], [ 5.959738, 50.430567 ], [ 5.959862, 50.430779 ], [ 5.960046, 50.4311 ], [ 5.960365, 50.431463 ], [ 5.960715, 50.431779 ], [ 5.961247, 50.43216 ], [ 5.962135, 50.432712 ], [ 5.962656, 50.432971 ], [ 5.9631, 50.433136 ], [ 5.965385, 50.433895 ], [ 5.965716, 50.434027 ], [ 5.96603, 50.434183 ], [ 5.96632, 50.434357 ], [ 5.966568, 50.434546 ], [ 5.966799, 50.434744 ], [ 5.967107, 50.435106 ], [ 5.967356, 50.435455 ], [ 5.967924, 50.436261 ], [ 5.968024, 50.436436 ], [ 5.968084, 50.436624 ], [ 5.968095, 50.43686 ], [ 5.968036, 50.437072 ], [ 5.967699, 50.437624 ], [ 5.967332, 50.438232 ], [ 5.966888, 50.438991 ], [ 5.966775, 50.439273 ], [ 5.966669, 50.439608 ], [ 5.966604, 50.439919 ], [ 5.966562, 50.440183 ], [ 5.966432, 50.441404 ], [ 5.966456, 50.441484 ], [ 5.966533, 50.441541 ], [ 5.966651, 50.44156 ], [ 5.966852, 50.441541 ], [ 5.96706, 50.441541 ], [ 5.967202, 50.44156 ], [ 5.967296, 50.441626 ], [ 5.96732, 50.441701 ], [ 5.967261, 50.4418 ], [ 5.966533, 50.442559 ], [ 5.96502, 50.444251 ] ] } }\r\n]\r\n}";

    //BA-KE
    const string geoJson =
        "{\r\n  \"type\": \"FeatureCollection\",\r\n  \"features\": [\r\n    {\r\n      \"type\": \"Feature\",\r\n      \"properties\": {},\r\n      \"geometry\": {\r\n        \"coordinates\": [\r\n          [\r\n            17.104641838716873,\r\n            48.13181888769941\r\n          ],\r\n          [\r\n            17.13184717176395,\r\n            48.13071077807251\r\n          ],\r\n          [\r\n            17.1520859707272,\r\n            48.14185618721049\r\n          ],\r\n          [\r\n            17.1744327100657,\r\n            48.14259470533824\r\n          ],\r\n          [\r\n            17.180194708840133,\r\n            48.14724613428871\r\n          ],\r\n          [\r\n            17.18626295974849,\r\n            48.17376317070753\r\n          ],\r\n          [\r\n            17.21536863330195,\r\n            48.19270413185046\r\n          ],\r\n          [\r\n            17.250711905763325,\r\n            48.21048638163592\r\n          ],\r\n          [\r\n            17.274941998132277,\r\n            48.21464022670639\r\n          ],\r\n          [\r\n            17.317884982003022,\r\n            48.214639489239715\r\n          ],\r\n          [\r\n            17.342433768545305,\r\n            48.22120966034535\r\n          ],\r\n          [\r\n            17.369759930122342,\r\n            48.23852276446391\r\n          ],\r\n          [\r\n            17.387116464256565,\r\n            48.24405700611999\r\n          ],\r\n          [\r\n            17.427769367894456,\r\n            48.249135922279095\r\n          ],\r\n          [\r\n            17.455352029840725,\r\n            48.26442256271167\r\n          ],\r\n          [\r\n            17.4792360938703,\r\n            48.28428480322532\r\n          ],\r\n          [\r\n            17.505242657629168,\r\n            48.296048159923345\r\n          ],\r\n          [\r\n            17.539255688963436,\r\n            48.30342998715753\r\n          ],\r\n          [\r\n            17.59532895056472,\r\n            48.31899535161503\r\n          ],\r\n          [\r\n            17.631714851179197,\r\n            48.33811748924472\r\n          ],\r\n          [\r\n            17.666039324821753,\r\n            48.3558523933975\r\n          ],\r\n          [\r\n            17.716683165611983,\r\n            48.36874617123442\r\n          ],\r\n          [\r\n            17.737130828933743,\r\n            48.38325918020652\r\n          ],\r\n          [\r\n            17.74718409734868,\r\n            48.400293839098566\r\n          ],\r\n          [\r\n            17.748220776680228,\r\n            48.41433039202698\r\n          ],\r\n          [\r\n            17.741629905159556,\r\n            48.43433974186647\r\n          ],\r\n          [\r\n            17.73781288438329,\r\n            48.459164321093\r\n          ],\r\n          [\r\n            17.749940037910477,\r\n            48.484210262808745\r\n          ],\r\n          [\r\n            17.776270387596526,\r\n            48.51956632308921\r\n          ],\r\n          [\r\n            17.7885701084779,\r\n            48.55145496497684\r\n          ],\r\n          [\r\n            17.789608117613227,\r\n            48.58401406471742\r\n          ],\r\n          [\r\n            17.793415163887374,\r\n            48.602571729652226\r\n          ],\r\n          [\r\n            17.807271658335225,\r\n            48.62982728118095\r\n          ],\r\n          [\r\n            17.819047835441438,\r\n            48.643332348207906\r\n          ],\r\n          [\r\n            17.83463212354806,\r\n            48.64951161518567\r\n          ],\r\n          [\r\n            17.85471914189648,\r\n            48.65065563308545\r\n          ],\r\n          [\r\n            17.86751612239206,\r\n            48.6607213726582\r\n          ],\r\n          [\r\n            17.872652133907422,\r\n            48.673283946456934\r\n          ],\r\n          [\r\n            17.873210233866814,\r\n            48.70129738763302\r\n          ],\r\n          [\r\n            17.874612947317928,\r\n            48.72162471849211\r\n          ],\r\n          [\r\n            17.86802685155712,\r\n            48.733970376010376\r\n          ],\r\n          [\r\n            17.86005520163701,\r\n            48.74174133709016\r\n          ],\r\n          [\r\n            17.86178650792624,\r\n            48.754079017727804\r\n          ],\r\n          [\r\n            17.876332267705266,\r\n            48.77074569169983\r\n          ],\r\n          [\r\n            17.879093185364013,\r\n            48.77948132064705\r\n          ],\r\n          [\r\n            17.888805803623598,\r\n            48.79183651241851\r\n          ],\r\n          [\r\n            17.893301263595617,\r\n            48.79938879432427\r\n          ],\r\n          [\r\n            17.904773272839776,\r\n            48.806004983578106\r\n          ],\r\n          [\r\n            17.90755257843918,\r\n            48.81811774192332\r\n          ],\r\n          [\r\n            17.945026830928498,\r\n            48.84598636908987\r\n          ],\r\n          [\r\n            17.957730031837315,\r\n            48.85997118990713\r\n          ],\r\n          [\r\n            17.978411917470197,\r\n            48.87707615764057\r\n          ],\r\n          [\r\n            17.982214269083585,\r\n            48.883790356308054\r\n          ],\r\n          [\r\n            17.983491156897287,\r\n            48.89879665217086\r\n          ],\r\n          [\r\n            17.998350419734322,\r\n            48.90845578995038\r\n          ],\r\n          [\r\n            18.03259571385476,\r\n            48.913754095159874\r\n          ],\r\n          [\r\n            18.060370495181957,\r\n            48.91337169267072\r\n          ],\r\n          [\r\n            18.070964827656923,\r\n            48.920699490152884\r\n          ],\r\n          [\r\n            18.08440787917857,\r\n            48.92711838831775\r\n          ],\r\n          [\r\n            18.097664779562763,\r\n            48.94300193815914\r\n          ],\r\n          [\r\n            18.139666890461115,\r\n            48.96413888042585\r\n          ],\r\n          [\r\n            18.221455451351574,\r\n            48.99996472332961\r\n          ],\r\n          [\r\n            18.239300315285874,\r\n            49.0105172455786\r\n          ],\r\n          [\r\n            18.25922937214918,\r\n            49.021069218837994\r\n          ],\r\n          [\r\n            18.273418590780807,\r\n            49.037471092131284\r\n          ],\r\n          [\r\n            18.283198251835614,\r\n            49.045727047307\r\n          ],\r\n          [\r\n            18.308610451589516,\r\n            49.04689649874072\r\n          ],\r\n          [\r\n            18.325115263798608,\r\n            49.05329455743495\r\n          ],\r\n          [\r\n            18.343558492073186,\r\n            49.06383318205397\r\n          ],\r\n          [\r\n            18.380944477866933,\r\n            49.0633629097282\r\n          ],\r\n          [\r\n            18.39542718396254,\r\n            49.06885782513842\r\n          ],\r\n          [\r\n            18.415822397057582,\r\n            49.07591970286501\r\n          ],\r\n          [\r\n            18.420275559394952,\r\n            49.087962284488185\r\n          ],\r\n          [\r\n            18.416134315126016,\r\n            49.1004472465182\r\n          ],\r\n          [\r\n            18.416104730807405,\r\n            49.107934482583346\r\n          ],\r\n          [\r\n            18.435206546490576,\r\n            49.11502185622865\r\n          ],\r\n          [\r\n            18.464042966107883,\r\n            49.13981234420439\r\n          ],\r\n          [\r\n            18.46225024335365,\r\n            49.152319966896044\r\n          ],\r\n          [\r\n            18.47897328883974,\r\n            49.16390803424957\r\n          ],\r\n          [\r\n            18.486540473553845,\r\n            49.18047520788673\r\n          ],\r\n          [\r\n            18.508720677605737,\r\n            49.187273559788\r\n          ],\r\n          [\r\n            18.528267685199125,\r\n            49.20814665807569\r\n          ],\r\n          [\r\n            18.5526774393484,\r\n            49.21204366716583\r\n          ],\r\n          [\r\n            18.577076546928282,\r\n            49.21798084665477\r\n          ],\r\n          [\r\n            18.617670654827663,\r\n            49.22778317248313\r\n          ],\r\n          [\r\n            18.632484017311754,\r\n            49.22636596212121\r\n          ],\r\n          [\r\n            18.6459577938721,\r\n            49.220738964167055\r\n          ],\r\n          [\r\n            18.662248874493088,\r\n            49.21985371281065\r\n          ],\r\n          [\r\n            18.666465287702238,\r\n            49.21393004200996\r\n          ],\r\n          [\r\n            18.666131319676282,\r\n            49.20506069838626\r\n          ],\r\n          [\r\n            18.678425546579916,\r\n            49.19885401991769\r\n          ],\r\n          [\r\n            18.68857502322919,\r\n            49.19586895603513\r\n          ],\r\n          [\r\n            18.701117430825917,\r\n            49.18881060075398\r\n          ],\r\n          [\r\n            18.71896719070793,\r\n            49.18718027787415\r\n          ],\r\n          [\r\n            18.727629418929354,\r\n            49.17763727866023\r\n          ],\r\n          [\r\n            18.737396246743714,\r\n            49.179682005112085\r\n          ],\r\n          [\r\n            18.898520111486306,\r\n            49.13237682921968\r\n          ],\r\n          [\r\n            18.92313495251514,\r\n            49.12246768197991\r\n          ],\r\n          [\r\n            18.94014310498443,\r\n            49.11883211633955\r\n          ],\r\n          [\r\n            18.952412242801273,\r\n            49.10946411039771\r\n          ],\r\n          [\r\n            18.973644672726408,\r\n            49.1087864411038\r\n          ],\r\n          [\r\n            18.98998641752263,\r\n            49.10354854985485\r\n          ],\r\n          [\r\n            19.009463409247473,\r\n            49.10332687470242\r\n          ],\r\n          [\r\n            19.030618056235653,\r\n            49.099247032020656\r\n          ],\r\n          [\r\n            19.053280318400084,\r\n            49.10721203202084\r\n          ],\r\n          [\r\n            19.06301605507346,\r\n            49.11564323202117\r\n          ],\r\n          [\r\n            19.070547070693976,\r\n            49.13203092173171\r\n          ],\r\n          [\r\n            19.082303208367193,\r\n            49.1361177151806\r\n          ],\r\n          [\r\n            19.091924315257188,\r\n            49.145874217549164\r\n          ],\r\n          [\r\n            19.095999610159566,\r\n            49.15207328291123\r\n          ],\r\n          [\r\n            19.101411304286188,\r\n            49.150725948113404\r\n          ],\r\n          [\r\n            19.10364483014021,\r\n            49.14538552596093\r\n          ],\r\n          [\r\n            19.107190339593444,\r\n            49.145865625501955\r\n          ],\r\n          [\r\n            19.10683818616579,\r\n            49.15129834654164\r\n          ],\r\n          [\r\n            19.11218332293427,\r\n            49.155552388354494\r\n          ],\r\n          [\r\n            19.119033066486594,\r\n            49.155558962080846\r\n          ],\r\n          [\r\n            19.129022446717414,\r\n            49.150585527452904\r\n          ],\r\n          [\r\n            19.13510013378243,\r\n            49.149728692477936\r\n          ],\r\n          [\r\n            19.138933058623365,\r\n            49.15268698592351\r\n          ],\r\n          [\r\n            19.16430212290814,\r\n            49.14635726847018\r\n          ],\r\n          [\r\n            19.17071378846981,\r\n            49.14235010786834\r\n          ],\r\n          [\r\n            19.171588710161302,\r\n            49.13421168069905\r\n          ],\r\n          [\r\n            19.170287928866884,\r\n            49.126678574469906\r\n          ],\r\n          [\r\n            19.16911513103787,\r\n            49.12361335194558\r\n          ],\r\n          [\r\n            19.17838005048722,\r\n            49.117718910019335\r\n          ],\r\n          [\r\n            19.19515310222411,\r\n            49.12163199622208\r\n          ],\r\n          [\r\n            19.206593497183718,\r\n            49.120400969314176\r\n          ],\r\n          [\r\n            19.21356647395271,\r\n            49.117996537682785\r\n          ],\r\n          [\r\n            19.22205650747,\r\n            49.119295077172154\r\n          ],\r\n          [\r\n            19.226424652704083,\r\n            49.118471651001215\r\n          ],\r\n          [\r\n            19.223696366755604,\r\n            49.11400591554238\r\n          ],\r\n          [\r\n            19.22533401457369,\r\n            49.11016893112921\r\n          ],\r\n          [\r\n            19.234310940395858,\r\n            49.10778083313093\r\n          ],\r\n          [\r\n            19.2412621193931,\r\n            49.104431361528384\r\n          ],\r\n          [\r\n            19.24417702577381,\r\n            49.0989215629686\r\n          ],\r\n          [\r\n            19.249230299537885,\r\n            49.09656942096666\r\n          ],\r\n          [\r\n            19.259548120678602,\r\n            49.09595635088198\r\n          ],\r\n          [\r\n            19.266689636676233,\r\n            49.09223593554006\r\n          ],\r\n          [\r\n            19.271154728238457,\r\n            49.08751225849994\r\n          ],\r\n          [\r\n            19.2751688213165,\r\n            49.08307289577738\r\n          ],\r\n          [\r\n            19.287792652580265,\r\n            49.08442552185002\r\n          ],\r\n          [\r\n            19.29581486108512,\r\n            49.08468526524723\r\n          ],\r\n          [\r\n            19.301250360715585,\r\n            49.08561346499607\r\n          ],\r\n          [\r\n            19.31728002889261,\r\n            49.0772934901336\r\n          ],\r\n          [\r\n            19.358454239852904,\r\n            49.079746925405175\r\n          ],\r\n          [\r\n            19.392638416410193,\r\n            49.088415964469476\r\n          ],\r\n          [\r\n            19.41380162367767,\r\n            49.092004811483775\r\n          ],\r\n          [\r\n            19.434873923541204,\r\n            49.0973793916302\r\n          ],\r\n          [\r\n            19.442950098588312,\r\n            49.09642024372101\r\n          ],\r\n          [\r\n            19.44678045618437,\r\n            49.09173052563344\r\n          ],\r\n          [\r\n            19.467803445906554,\r\n            49.087410299043256\r\n          ],\r\n          [\r\n            19.487150332629398,\r\n            49.09052528321308\r\n          ],\r\n          [\r\n            19.50050413790828,\r\n            49.087291369376715\r\n          ],\r\n          [\r\n            19.514042042629114,\r\n            49.09185393397223\r\n          ],\r\n          [\r\n            19.531854323968872,\r\n            49.09044016619913\r\n          ],\r\n          [\r\n            19.540833528099284,\r\n            49.087142761270314\r\n          ],\r\n          [\r\n            19.551290970291433,\r\n            49.08714066722217\r\n          ],\r\n          [\r\n            19.556977157851662,\r\n            49.08337925619216\r\n          ],\r\n          [\r\n            19.572870921689457,\r\n            49.08115640340654\r\n          ],\r\n          [\r\n            19.58409791387308,\r\n            49.08196855799454\r\n          ],\r\n          [\r\n            19.596572745499913,\r\n            49.07565571505842\r\n          ],\r\n          [\r\n            19.60594159718437,\r\n            49.073057894986505\r\n          ],\r\n          [\r\n            19.622908898690866,\r\n            49.07152076352679\r\n          ],\r\n          [\r\n            19.645055821208643,\r\n            49.065145621857255\r\n          ],\r\n          [\r\n            19.666702216203134,\r\n            49.05796333093707\r\n          ],\r\n          [\r\n            19.683189288873393,\r\n            49.05631166570228\r\n          ],\r\n          [\r\n            19.695375780122617,\r\n            49.05759381593029\r\n          ],\r\n          [\r\n            19.71624337430842,\r\n            49.05309118315978\r\n          ],\r\n          [\r\n            19.745221784513575,\r\n            49.05948970065933\r\n          ],\r\n          [\r\n            19.753310990445897,\r\n            49.05890159205063\r\n          ],\r\n          [\r\n            19.78419244128989,\r\n            49.05126469838345\r\n          ],\r\n          [\r\n            19.797203557014456,\r\n            49.052872437158925\r\n          ],\r\n          [\r\n            19.807620362331164,\r\n            49.05594658905787\r\n          ],\r\n          [\r\n            19.82398715998022,\r\n            49.05629721836246\r\n          ],\r\n          [\r\n            19.832491121899125,\r\n            49.0581793776806\r\n          ],\r\n          [\r\n            19.852431007292466,\r\n            49.0557051268226\r\n          ],\r\n          [\r\n            19.867555148565202,\r\n            49.05983138840827\r\n          ],\r\n          [\r\n            19.896996841416012,\r\n            49.07047244376335\r\n          ],\r\n          [\r\n            19.91178415817555,\r\n            49.07130448561418\r\n          ],\r\n          [\r\n            19.93823587114258,\r\n            49.065885734406436\r\n          ],\r\n          [\r\n            19.950802535050173,\r\n            49.06423814505777\r\n          ],\r\n          [\r\n            19.960542884795302,\r\n            49.06411178576627\r\n          ],\r\n          [\r\n            19.97089840887739,\r\n            49.06764366669981\r\n          ],\r\n          [\r\n            19.98223373540216,\r\n            49.07141310277942\r\n          ],\r\n          [\r\n            19.99869938719766,\r\n            49.069887533991505\r\n          ],\r\n          [\r\n            20.01011833090311,\r\n            49.070142406847964\r\n          ],\r\n          [\r\n            20.02420837748747,\r\n            49.06932967152798\r\n          ],\r\n          [\r\n            20.03837643768651,\r\n            49.069704405056285\r\n          ],\r\n          [\r\n            20.05114407674,\r\n            49.06738221195252\r\n          ],\r\n          [\r\n            20.066390018641215,\r\n            49.06537675040428\r\n          ],\r\n          [\r\n            20.081351852079223,\r\n            49.06359456152802\r\n          ],\r\n          [\r\n            20.099696308230648,\r\n            49.07097512792615\r\n          ],\r\n          [\r\n            20.115052015548827,\r\n            49.07274298180039\r\n          ],\r\n          [\r\n            20.12775146649318,\r\n            49.07035383082075\r\n          ],\r\n          [\r\n            20.142677957095856,\r\n            49.063796051352114\r\n          ],\r\n          [\r\n            20.154234943934966,\r\n            49.0644639738191\r\n          ],\r\n          [\r\n            20.165019271982345,\r\n            49.06699543803745\r\n          ],\r\n          [\r\n            20.18457132868369,\r\n            49.064432466887325\r\n          ],\r\n          [\r\n            20.19690189151234,\r\n            49.06464251566129\r\n          ],\r\n          [\r\n            20.208607974799207,\r\n            49.06309369351638\r\n          ],\r\n          [\r\n            20.234056682026022,\r\n            49.06484336801876\r\n          ],\r\n          [\r\n            20.261913157987834,\r\n            49.064944203517655\r\n          ],\r\n          [\r\n            20.270226088230913,\r\n            49.06896693582962\r\n          ],\r\n          [\r\n            20.28319614959716,\r\n            49.075949801578105\r\n          ],\r\n          [\r\n            20.296783498084125,\r\n            49.075831754333905\r\n          ],\r\n          [\r\n            20.309263571705344,\r\n            49.075946422940945\r\n          ],\r\n          [\r\n            20.319773947574618,\r\n            49.0733364616745\r\n          ],\r\n          [\r\n            20.349293191618955,\r\n            49.06862185009007\r\n          ],\r\n          [\r\n            20.358008123702916,\r\n            49.05908167562208\r\n          ],\r\n          [\r\n            20.36563510273905,\r\n            49.0515047888363\r\n          ],\r\n          [\r\n            20.382637511884468,\r\n            49.04610069077404\r\n          ],\r\n          [\r\n            20.399518605395457,\r\n            49.03949853361539\r\n          ],\r\n          [\r\n            20.411724126938026,\r\n            49.037143330800546\r\n          ],\r\n          [\r\n            20.425674057820544,\r\n            49.037021768634844\r\n          ],\r\n          [\r\n            20.431745314332602,\r\n            49.03429733717516\r\n          ],\r\n          [\r\n            20.437370458980638,\r\n            49.02834777716228\r\n          ],\r\n          [\r\n            20.4380918472973,\r\n            49.02284312022704\r\n          ],\r\n          [\r\n            20.44589712434015,\r\n            49.017432451735885\r\n          ],\r\n          [\r\n            20.466061309185903,\r\n            49.00710301806413\r\n          ],\r\n          [\r\n            20.48315158783413,\r\n            49.0029695196194\r\n          ],\r\n          [\r\n            20.512586403221775,\r\n            49.0012016903047\r\n          ],\r\n          [\r\n            20.52692064753907,\r\n            49.000191247615874\r\n          ],\r\n          [\r\n            20.543907871629017,\r\n            49.002294660152046\r\n          ],\r\n          [\r\n            20.560247886524223,\r\n            49.00001751051667\r\n          ],\r\n          [\r\n            20.574439648182675,\r\n            49.00393642590535\r\n          ],\r\n          [\r\n            20.596458415491327,\r\n            49.008586313458096\r\n          ],\r\n          [\r\n            20.61225355752697,\r\n            49.01036999013371\r\n          ],\r\n          [\r\n            20.630346345680408,\r\n            49.00693052476595\r\n          ],\r\n          [\r\n            20.64411579830582,\r\n            49.00622213765939\r\n          ],\r\n          [\r\n            20.66678879151533,\r\n            49.00966635091339\r\n          ],\r\n          [\r\n            20.695991253169865,\r\n            49.00620930022029\r\n          ],\r\n          [\r\n            20.728540261439974,\r\n            49.009073682296844\r\n          ],\r\n          [\r\n            20.763197067723553,\r\n            49.00776839248823\r\n          ],\r\n          [\r\n            20.78690269793708,\r\n            49.00623830520419\r\n          ],\r\n          [\r\n            20.80681188554081,\r\n            49.00931230241463\r\n          ],\r\n          [\r\n            20.83976679390352,\r\n            49.009784977258846\r\n          ],\r\n          [\r\n            20.85330460573988,\r\n            49.0113680622855\r\n          ],\r\n          [\r\n            20.864470045854944,\r\n            49.00976713435992\r\n          ],\r\n          [\r\n            20.886858615993845,\r\n            49.00092968056788\r\n          ],\r\n          [\r\n            20.902634097759744,\r\n            48.996296623348485\r\n          ],\r\n          [\r\n            20.922400790881625,\r\n            48.9958339012332\r\n          ],\r\n          [\r\n            20.9345711757326,\r\n            49.002514400269064\r\n          ],\r\n          [\r\n            20.944335650749082,\r\n            49.01313598830515\r\n          ],\r\n          [\r\n            20.953973295632466,\r\n            49.01558970601877\r\n          ],\r\n          [\r\n            20.96984970288841,\r\n            49.01891225177019\r\n          ],\r\n          [\r\n            20.97710322353862,\r\n            49.01930409160258\r\n          ],\r\n          [\r\n            20.988308181159482,\r\n            49.022977560740856\r\n          ],\r\n          [\r\n            20.995989556169377,\r\n            49.02727561442836\r\n          ],\r\n          [\r\n            21.01101123393579,\r\n            49.026913365117366\r\n          ],\r\n          [\r\n            21.022657929566606,\r\n            49.026668977082835\r\n          ],\r\n          [\r\n            21.03431376873155,\r\n            49.021622659582334\r\n          ],\r\n          [\r\n            21.043285313316574,\r\n            49.013100235309196\r\n          ],\r\n          [\r\n            21.0536723006646,\r\n            49.00765960120239\r\n          ],\r\n          [\r\n            21.06087846951334,\r\n            48.999179430064174\r\n          ],\r\n          [\r\n            21.06754116290773,\r\n            48.99662080316634\r\n          ],\r\n          [\r\n            21.0814545492712,\r\n            48.999649291628316\r\n          ],\r\n          [\r\n            21.106566857129906,\r\n            49.00060773213846\r\n          ],\r\n          [\r\n            21.13311767355853,\r\n            49.00853916079862\r\n          ],\r\n          [\r\n            21.162180273047568,\r\n            49.00329991711959\r\n          ],\r\n          [\r\n            21.17654116431791,\r\n            49.00271014454759\r\n          ],\r\n          [\r\n            21.194171313962187,\r\n            48.99775349637329\r\n          ],\r\n          [\r\n            21.20745743980163,\r\n            48.995162891509295\r\n          ],\r\n          [\r\n            21.213551660996018,\r\n            48.98130078181279\r\n          ],\r\n          [\r\n            21.221072374870943,\r\n            48.97444363137507\r\n          ],\r\n          [\r\n            21.245926524631443,\r\n            48.965135931317576\r\n          ],\r\n          [\r\n            21.25255713039212,\r\n            48.95268138556358\r\n          ],\r\n          [\r\n            21.26023939030273,\r\n            48.93843289408821\r\n          ],\r\n          [\r\n            21.258150459205154,\r\n            48.92540156244718\r\n          ],\r\n          [\r\n            21.250145398557947,\r\n            48.90746679782245\r\n          ],\r\n          [\r\n            21.24888972668856,\r\n            48.88903346865888\r\n          ],\r\n          [\r\n            21.254504109644245,\r\n            48.86942496628393\r\n          ],\r\n          [\r\n            21.266253184010395,\r\n            48.85848944096122\r\n          ],\r\n          [\r\n            21.28669200343097,\r\n            48.84861247700445\r\n          ],\r\n          [\r\n            21.30402997513258,\r\n            48.83639892647119\r\n          ],\r\n          [\r\n            21.311288441592183,\r\n            48.82113818878162\r\n          ],\r\n          [\r\n            21.309844848187566,\r\n            48.80694065734059\r\n          ],\r\n          [\r\n            21.313448764753247,\r\n            48.78933479111589\r\n          ],\r\n          [\r\n            21.31307988477394,\r\n            48.782852063421075\r\n          ],\r\n          [\r\n            21.3225599163585,\r\n            48.773488048985655\r\n          ],\r\n          [\r\n            21.326752230319613,\r\n            48.76436125107347\r\n          ],\r\n          [\r\n            21.333610372308158,\r\n            48.74570613799776\r\n          ],\r\n          [\r\n            21.346088705340094,\r\n            48.740566424683664\r\n          ],\r\n          [\r\n            21.363305053212997,\r\n            48.74258410329526\r\n          ],\r\n          [\r\n            21.378613745744218,\r\n            48.74150244593386\r\n          ],\r\n          [\r\n            21.392700360477875,\r\n            48.73459917330871\r\n          ],\r\n          [\r\n            21.411974727019157,\r\n            48.72917210446795\r\n          ],\r\n          [\r\n            21.424732191801667,\r\n            48.72727381726446\r\n          ],\r\n          [\r\n            21.434837215654653,\r\n            48.72429322517712\r\n          ]\r\n        ],\r\n        \"type\": \"LineString\"\r\n      }\r\n    }\r\n  ]\r\n}";


    //driversList = driversList!.Take(200).ToList();
    points = GetTrackPoints(geoJson);

    foreach (var x in driversList)
    {
        drivers[x.ToString()] = random.Next(0, points.Count - 10);
    }

    var raceDataDto = new RaceDataDto
    {
        Drivers = driversList.Select(x => new DriverDto
        {
            Id = x
        }).ToList(),
        GeoJsonData = geoJson,
        LapCount = 3,
        RaceId = raceId
    };

    LoadRaceData(raceDataDto);

    var driversId = drivers.Keys.ToList();

    while (true)
    {
        foreach (var driverId in driversId)
        {
            SimulateMovement(driverId);
        }
        SendGpsDataToBackend();
        Thread.Sleep(delay);
    }
}

RaceDataDto GetRaceData()
{
    int collectionId;
    string geoJson;
    int lapCount;

    const string sql1 = @"
            SELECT
                ""CollectionId"",
                CASE
                    WHEN ""LayoutId"" IS NOT NULL THEN (SELECT ""GeoJson"" FROM ""Layout"" WHERE ""Layout"".""Id"" = ""Session"".""LayoutId"")
                    ELSE ""GeoJson""
                END AS ""GeoJson"",
                ""Laps"" AS ""LapCount"",
                ""Token""
            FROM
                ""Session""
            WHERE
                ""Id"" = @Id;";

    using var connection = new NpgsqlConnection(connectionString);
    connection.Open();

    using var command1 = new NpgsqlCommand(sql1, connection);
    {
        command1.Parameters.AddWithValue("@Id", raceId);

        var reader1 = command1.ExecuteReader();

        if (reader1.HasRows)
        {
            reader1.Read(); 
            collectionId = reader1.GetInt32(0); 
            geoJson = reader1.GetString(1); 
            lapCount = reader1.GetInt32(2); 
            token = reader1.GetString(3); 
        }
        else
        {
            throw new Exception("Race not found");
        }
    }

    connection.Close();
    connection.Open();

    const string sql2 = @"
            SELECT ""GpsDevice""
            FROM ""Driver""
            JOIN ""DriverCollection"" DC ON ""Driver"".""Id"" = DC.""DriverId""
            WHERE ""CollectionId"" = @CollectionId;";

    using var command2 = new NpgsqlCommand(sql2, connection);
    command2.Parameters.AddWithValue("@CollectionId", collectionId);

    using var reader2 = command2.ExecuteReader();

    var driverDtos = new List<DriverDto>();

    while (reader2.Read())
    {
        var gpsDevice = reader2.GetGuid(0);
        driverDtos.Add(new DriverDto
        {
            Id = gpsDevice
        });
    }

    connection.Close();

    return new RaceDataDto
    {
        Drivers = driverDtos, //.Take(3).ToList(),
        GeoJsonData = geoJson,
        LapCount = lapCount,
        RaceId = raceId
    };
}

IList<Position> GetTrackPoints(string geoJsonData)
{
    var ret = new List<Position>();

    var featureCollection = JsonConvert.DeserializeObject<FeatureCollection>(geoJsonData);
    if (featureCollection is null)
    {
        throw new Exception("feature collection is null");
    }

    foreach (var feature in featureCollection.Features)
    {
        if (feature.Geometry is not LineString lineString)
            continue;

        var coordinates = lineString.Coordinates;

        for (var i = 0; i < coordinates.Count - 1; i++)
        {
            var coord1 = coordinates[i];
            var coord2 = coordinates[i + 1];

            var segmentCoords = new List<IPosition>
            {
                coord1,
                coord2
            };
            var segmentLineString = new LineString(segmentCoords);

            var distance = CalculateDistance(coord1, coord2);
            var numberOfPoints = Convert.ToInt32(Math.Ceiling(distance / 3));

            var segmentPoints = InterpolatePoints(segmentLineString, numberOfPoints);

            ret = ret.Concat(segmentPoints).ToList();
        }
    }
    return ret;
}

IEnumerable<Position> InterpolatePoints(LineString lineString, int numberOfPoints)
{
    if (lineString.Coordinates.Count < 2)
    {
        throw new ArgumentException("LineString must contain at least two points.");
    }

    var interpolatedPoints = new List<Position>();

    for (var i = 0; i <= numberOfPoints; i++)
    {
        var t = i / (double)numberOfPoints;
        var latitude = Interpolate(lineString.Coordinates[0].Latitude, lineString.Coordinates[1].Latitude, t);
        var longitude = Interpolate(lineString.Coordinates[0].Longitude, lineString.Coordinates[1].Longitude, t);
        interpolatedPoints.Add(new Position(latitude, longitude));
    }

    return interpolatedPoints;
}

double Interpolate(double start, double end, double t)
{
    return start + t * (end - start);
}

double CalculateDistance(IPosition coord1, IPosition coord2)
{
    const double earthRadius = 6371; // Earth radius in kilometers

    var lat1 = ToRadians(coord1.Latitude);
    var lon1 = ToRadians(coord1.Longitude);
    var lat2 = ToRadians(coord2.Latitude);
    var lon2 = ToRadians(coord2.Longitude);

    var dLon = lon2 - lon1;
    var dLat = lat2 - lat1;

    var a = Math.Pow(Math.Sin(dLat / 2), 2) +
            Math.Cos(lat1) * Math.Cos(lat2) *
            Math.Pow(Math.Sin(dLon / 2), 2);

    var c = 2 * Math.Atan2(Math.Sqrt(a), Math.Sqrt(1 - a));

    var distance = earthRadius * c;

    return distance * 1000; // Distance in meters
}

double ToRadians(double degrees)
{
    return degrees * (Math.PI / 180);
}

void SimulateMovement(string driverId)
{
    var randomNum = random.Next(1, 6);
    drivers[driverId] = (drivers[driverId] + randomNum) % points.Count;
}


void LoadRaceData(RaceDataDto raceDataDto1)
{
    var json = JsonConvert.SerializeObject(raceDataDto1);
    var content = new StringContent(json, Encoding.UTF8, "application/json");

    const string authenticationString = $"{user}:{password}";
    var base64EncodedAuthenticationString = Convert.ToBase64String(Encoding.ASCII.GetBytes(authenticationString));

    var requestMessage = new HttpRequestMessage(HttpMethod.Post, "race/load");
    requestMessage.Headers.Authorization = new AuthenticationHeaderValue("Basic", base64EncodedAuthenticationString);
    requestMessage.Content = content;

    var res = Task.Run(async () => await client.SendAsync(requestMessage)).Result.StatusCode;
    Console.WriteLine(res);
}

void LoadDriversPositions(IEnumerable<DriverDto> driversDto)
{
    foreach (var driverDto in driversDto)
    {
        drivers[driverDto.Id.ToString()] = random.Next(points.Count / 4 * 3, points.Count);
    }
}

void SendGpsDataToBackend()
{
    var data = drivers.Select(x =>
    {
        var point = points[x.Value];
        return new GpsData
        {
            DriverId = x.Key,
            Latitude = point.Latitude,
            Longitude = point.Longitude
        };
    }).ToList();
    var json = JsonConvert.SerializeObject(data);
    var content = new StringContent(json, Encoding.UTF8, "application/json");

    var httpRequestMessage = new HttpRequestMessage(HttpMethod.Put, "race/update");
    httpRequestMessage.Headers.Authorization = new AuthenticationHeaderValue("Bearer", token);
    httpRequestMessage.Content = content;

    var result = Task.Run(async () => await client.SendAsync(httpRequestMessage)).Result;
    Console.WriteLine(result.StatusCode);
}

#endregion